"use strict";var e=require("emag.biz"),n=require("../settings"),r=require("speedt-utils").utils,t=require("speedt-amq");exports.resetPwd=function(n,r,t){var i=n.body;e.user.resetPwd(i.id,"123456",function(e){if(e)return t(e);r.send({})})},exports.del=function(n,r,t){var i=n.body;e.user.del(i.id,function(e){if(e)return t(e);r.send({})})},exports.indexUI=function(r,t,i){e.user.findAll(1,function(e,s){if(e)return i(e);t.render("user/index",{conf:n,data:{list_user:s,session_user:r.session.user,nav_choose:",03,0301,"}})})},exports.editUI=function(r,t,i){var s=r.query.id;e.user.getById(s).then(function(e){if(!e)return i(new Error("Not Found"));t.render("user/edit",{conf:n,data:{user:e,session_user:r.session.user,nav_choose:",03,0301,"}})}).catch(i)},exports.edit=function(n,r,t){var i=n.body;e.user.editInfo(i).then(function(){return r.send({})}).catch(t)},exports.giftUI=function(r,t,i){var s=r.query.id;e.gift.findAll(s,function(e,s){if(e)return i(e);t.render("user/gift",{conf:n,data:{list_gift:s,session_user:r.session.user,nav_choose:",03,0301,"}})})},exports.paymentUI=function(r,t,i){var s=r.query.id;e.user_payment.findAllByUserId(s,function(e,s){if(e)return i(e);t.render("user/payment",{conf:n,data:{list_payment:s,session_user:r.session.user,nav_choose:",03,0301,"}})})},function(){function n(e,n){return new Promise(function(t,i){if(0===n.length)return i(new Error("前置机未启动"));r(n,e).then(function(){return t()}).catch(i)})}function r(e,n){return new Promise(function(r,i){var s=!0,u=!1,o=void 0;try{for(var f,d=e[Symbol.iterator]();!(s=(f=d.next()).done);s=!0){f.value;t.send("/queue/qq.5015",{priority:8},JSON.stringify(n),function(e,n){})}}catch(e){u=!0,o=e}finally{try{!s&&d.return&&d.return()}finally{if(u)throw o}}r()})}exports.nasha=function(r,t,i){var s=r.body;return s.user_id&&s.group_id?void e.frontend.findAll().then(n.bind(null,s)).then(function(){return t.send({})}).catch(i):i(new Error("INVALID_PARAMS"))}}();