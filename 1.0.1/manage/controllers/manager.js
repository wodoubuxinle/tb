"use strict";var e=require("../settings"),r=require("speedt-utils").utils,n=require("emag.biz");exports.changePwd=function(e,r,s){var t=e.body;t.id=e.session.userId,n.manager.changePwd(t).then(function(){r.send({})}).catch(function(e){if("string"!=typeof e)return s(e);r.send({error:{msg:e}})})},exports.changePwdUI=function(r,n,s){n.render("manager/changePwd",{conf:e,data:{session_user:r.session.user}})},exports.profileUI=function(r,n,s){n.render("manager/profile",{conf:e,data:{session_user:r.session.user}})},exports.loginUI=function(r,n,s){n.render("manager/login",{conf:e,data:{refererUrl:r.query.refererUrl||""}})},exports.login=function(e,r,s){var t=e.body;n.manager.login(t).then(function(n){e.session.userId=n.id,e.session.user=n,r.send({})}).catch(function(e){if("string"!=typeof e)return s(e);r.send({error:{msg:e}})})},exports.login_validate=function(r,n,s){return r.session.userId?s():r.xhr?n.send({error:{msg:"无权访问"}}):void n.redirect(e.html.virtualPath+"manager/login?refererUrl="+escape(e.html.virtualPath+r.url.substr(1)))},exports.logoutUI=function(r,n,s){r.session.destroy(),n.redirect(e.html.virtualPath+"manager/login")};