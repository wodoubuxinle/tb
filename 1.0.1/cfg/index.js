"use strict";var e=require("path"),t=process.cwd(),r=require(e.join(t,"settings")),s=require("http"),o=require("speedt-utils").ajax,n=require("underscore"),i=require("log4js"),a=i.getLogger("cfg"),c=new Promise(function(e,t){o(s.request,{host:r.app.resHost,port:80,path:"/assets/cfg/fish.trail.json",method:"GET"},null,null).then(function(t){e(JSON.parse(t))}).catch(t)}),u=new Promise(function(e,t){o(s.request,{host:r.app.resHost,port:80,path:"/assets/cfg/fish.type.json",method:"GET"},null,null).then(function(t){e(JSON.parse(t))}).catch(t)}),l=new Promise(function(e,t){o(s.request,{host:r.app.resHost,port:80,path:"/assets/cfg/fish.fixed.json",method:"GET"},null,null).then(function(t){e(JSON.parse(t))}).catch(t)});Promise.all([c,u,l]).then(function(e){exports.fishTrail=e[0].data,exports.fishType=e[1].data,exports.fishFixed=e[2].data,require("emag.biz").cfg.findAll(null,function(e,t){if(e)return a.error("load dynamic config:",e);var r=exports.dynamic={},s=!0,o=!1,n=void 0;try{for(var i,c=t[Symbol.iterator]();!(s=(i=c.next()).done);s=!0){var u=i.value;r[u.type_]||(r[u.type_]={}),r[u.type_][u.key_]=u.value_}}catch(e){o=!0,n=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw n}}a.debug("loaded dynamic config:",r),a.info("loaded all config: success")})}).catch(function(e){a.error("load config:",e),process.exit(1)});