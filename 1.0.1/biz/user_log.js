"use strict";var e=require("path"),r=process.cwd(),i=require(e.join(r,"settings")),t=require("speedt-utils").utils,u=require("underscore"),s=require("node-uuid"),n=require("emag.db").mysql,d=require("emag.db").redis;!function(){exports.findAllByUserId=function(e,r){n.query("SELECT b.user_name, a.* FROM (SELECT * FROM s_user_log WHERE user_id=?) a LEFT JOIN s_user b ON (a.user_id=b.id) WHERE b.id IS NOT NULL ORDER BY a.create_time DESC",[e],r)}}(),function(){exports.saveNew=function(e,r){return e.id=t.replaceAll(s.v1(),"-",""),e.log_type=e.log_type||1,e.create_time=new Date,new Promise(function(i,t){(r||n).query("INSERT INTO s_user_log (id, log_desc, log_type, create_time, user_id) VALUES (?, ?, ?, ?, ?)",[e.id,e.log_desc,e.log_type,e.create_time,e.user_id],function(r){if(r)return t(r);i(e)})})}}();