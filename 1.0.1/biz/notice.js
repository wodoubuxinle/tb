"use strict";var e=require("path"),t=process.cwd(),i=require(e.join(t,"settings")),n=require("speedt-utils").utils,r=require("underscore"),u=require("node-uuid"),c=require("emag.db").mysql,o=require("emag.db").redis;!function(){exports.findAll=function(e){c.query("SELECT b.user_name, a.* FROM (SELECT * FROM w_notice) a LEFT JOIN s_manager b ON (a.user_id=b.id) WHERE b.id IS NOT NULL ORDER BY a.create_time DESC",null,e)}}(),function(){exports.saveNew=function(e,t){e.id=n.replaceAll(u.v1(),"-",""),e.create_time=new Date,c.query("INSERT INTO w_notice (id, title, content, create_time, user_id) VALUES (?, ?, ?, ?, ?)",[e.id,e.title,e.content,e.create_time,e.user_id],t)}}(),function(){exports.editInfo=function(e,t){c.query("UPDATE w_notice SET title=?, content=? WHERE id=?",[e.title,e.content,e.id],t)}}(),function(){exports.getById=function(e){return new Promise(function(t,i){c.query("SELECT a.* FROM w_notice a WHERE a.id=?",[e],function(e,n){if(e)return i(e);t(c.checkOnly(n)?n[0]:null)})})}}(),function(){exports.del=function(e,t){c.query("DELETE FROM w_notice WHERE id=?",[e],t)}}();