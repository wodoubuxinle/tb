"use strict";var e=require("path"),r=process.cwd(),n=require(e.join(r,"settings")),t=require("node-uuid"),i=require("underscore"),o=require("speedt-utils").md5,u=require("speedt-utils").utils,a=require("emag.db").mysql,c=require("emag.db").redis,s=require("emag.cfg"),_=require("emag.biz"),d=require("emag.model").roomPool,f=require("log4js").getLogger("biz.pushCake");!function(){function e(e,n){if(!n.group_id)return Promise.reject("不在群组");var t=d.get(n.group_id);if(!t)return Promise.reject("房间不存在");var i=t.ready(n.id);return"string"==typeof i?Promise.reject(i):(t.isStart()&&r(t.id,e),Promise.resolve(i))}function r(e,r){!function n(t){t=1e3*(t||10);var i=setTimeout(function(){clearTimeout(i);var t=d.get(e);if(t){switch(t.act_status){case"AS_DELAY_PLAYER_DICE":r(t.delay_PlayerDice()),5;break;case"AS_DELAY_BANKER_BET":r(t.delay_BankerBet()),3;break;case"AS_DELAY_BANKER_DICE":r(t.delay_BankerDice()),5;break;case"AS_WAIT_FOR_PLAYER_BET":r(t.timeOut_PlayerBet_Finish()),20;break;case"AS_DELAY_PLAYER_BET":r(t.delay_PlayerBet()),3;break;case"AS_DELAY_DEALCARD":r(t.delay_DealCard()),1;break;case"AS_DELAY_COMPARE_CARD":r(t.delay_ComepareCard()),5;break;case"AS_DELAY_COMPARE_CARD2":r(t.delay_ComepareCard2()),5;break;case"AS_DELAY_COMPARE_CARD3":r(t.delay_ComepareCard3()),5;break;case"AS_DELAY_BANKER_CONTINUE_BET":r(t.delay_BankerContinueBet()),3;break;case"AS_WAIT_FOR_NEXT_ROUND":r(t.timeOut_Next_Round(1)),20;break;case"AS_WAIT_FOR_NEXT_ROUND2":r(t.timeOut_Next_Round(2)),20;break;case"AS_WAIT_FOR_BANKER_CONTINUE":r(t.timeOut_Banker_Continue()),20;break;case"AS_GAMEOVER":return}n(t.delaytime)}},t)}()}exports.ready=function(r,n,t){return new Promise(function(i,o){_.user.getByChannelId(r,n).then(e.bind(null,t)).then(function(e){return i(e)}).catch(o)})}}(),function(){function e(e){if(!e.group_id)return Promise.reject("已经退出了");var r=d.get(e.group_id);if(!r)return Promise.reject("房间不存在");var n=r.craps4(e.id);return"string"==typeof n?Promise.reject(n):Promise.resolve(n)}exports.craps4=function(r,n,t){return new Promise(function(t,i){_.user.getByChannelId(r,n).then(e).then(function(e){return t(e)}).catch(i)})}}(),function(){function e(e,r){if(!r.group_id)return Promise.reject("已经退出了");var n=d.get(r.group_id);if(!n)return Promise.reject("房间不存在");var t=n.bankerBet(r.id,e);return"string"==typeof t?Promise.reject(t):Promise.resolve(t)}exports.bankerBet=function(r,n,t){return new Promise(function(i,o){_.user.getByChannelId(r,n).then(e.bind(null,t)).then(function(e){return i(e)}).catch(o)})}}(),function(){function e(e){if(!e.group_id)return Promise.reject("已经退出了");var r=d.get(e.group_id);if(!r)return Promise.reject("房间不存在");var n=r.bankerDice(e.id);return"string"==typeof n?Promise.reject(n):Promise.resolve(n)}exports.bankerDice=function(r,n){return new Promise(function(t,i){_.user.getByChannelId(r,n).then(e).then(function(e){return t(e)}).catch(i)})}}(),function(){function e(e,r){if(!r.group_id)return Promise.reject("已经退出了");var n=d.get(r.group_id);if(!n)return Promise.reject("房间不存在");var t=n.unBankerBet(r.id,e);return"string"==typeof t?Promise.reject(t):Promise.resolve(t)}exports.unBankerBet=function(r,n,t){return new Promise(function(i,o){_.user.getByChannelId(r,n).then(e.bind(null,t)).then(function(e){return i(e)}).catch(o)})}}(),function(){function e(e,r){if(!r.group_id)return Promise.reject("已经退出了");var n=d.get(r.group_id);if(!n)return Promise.reject("房间不存在");var t=n.banker_Continue(r.id,e);return console.log(t),console.log("-----"),"string"==typeof t?Promise.reject(t):Promise.resolve(t)}exports.bankerContinue=function(r,n,t){return new Promise(function(i,o){_.user.getByChannelId(r,n).then(e.bind(null,t)).then(function(e){return i(e)}).catch(o)})}}(),function(){function e(e,r){if(!r.group_id)return Promise.reject("已经退出了");var n=d.get(r.group_id);if(!n)return Promise.reject("房间不存在");var t=n.banker_Continue_Bet(r.id,e);return"string"==typeof t?Promise.reject(t):Promise.resolve(t)}exports.bankerContinueBet=function(r,n,t){return new Promise(function(i,o){_.user.getByChannelId(r,n).then(e.bind(null,t)).then(function(e){return i(e)}).catch(o)})}}();