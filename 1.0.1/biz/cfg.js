"use strict";var e=require("path"),t=process.cwd(),r=require(e.join(t,"settings")),i=require("speedt-utils").utils,n=require("underscore"),u=require("emag.db").mysql,a=require("emag.db").redis;!function(){exports.findByType=function(e,t){u.query("SELECT a.* FROM s_cfg a WHERE a.type_=? ORDER BY a.title ASC",[e],t)}}(),exports.findAll=function(e,t){var r="SELECT a.* FROM s_cfg a";null!==e&&(r+=" WHERE a.status=?"),r+=" ORDER BY a.title ASC",u.query(r,[e],t)},function(){exports.editInfo=function(e,t){u.query("UPDATE s_cfg SET value_=? WHERE key_=? AND type_=?",[e.value_,e.key_,e.type_],function(i,n){if(i)return t(i);a.select(r.redis.database,function(r){if(r)return t(r);a.hset("cfg::"+e.type_,e.key_,e.value_,a.print),t(null,e)})})}}(),exports.init=function(e){this.findAll(null,function(t,i){if(t)return e(t);a.select(r.redis.database,function(t){if(t)return e(t);var r=!0,n=!1,u=void 0;try{for(var s,l=i[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var f=s.value;a.hset("cfg::"+f.type_,f.key_,f.value_,a.print)}}catch(t){n=!0,u=t}finally{try{!r&&l.return&&l.return()}finally{if(n)throw u}}e(null,i)})})};