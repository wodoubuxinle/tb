"use strict";var e=require("path"),o=process.cwd(),i=require(e.join(o,"settings")),n=require("speedt-utils").utils,t=require("underscore"),r=require("node-uuid"),d=require("emag.db").mysql,s=require("emag.db").redis;!function(){exports.findAll=function(e){d.query("SELECT a.* FROM w_goods a ORDER BY a.create_time DESC",null,e)}}(),function(){exports.findDetailById=function(e,o){return new Promise(function(i,n){(o||d).query("SELECT c.prop_name game_prop_name, b.goods_name, a.* FROM (SELECT * FROM w_goods_detail WHERE goods_id=?) a LEFT JOIN w_goods b ON (a.goods_id=b.id) LEFT JOIN w_game_prop c ON (a.game_prop_id=c.id) WHERE b.id IS NOT NULL AND c.id IS NOT NULL ORDER BY a.create_time DESC",[e],function(e,o){if(e)return n(e);i(o)})})}}(),function(){exports.saveNew=function(e,o){d.query("INSERT INTO w_goods (id, goods_name, goods_desc, create_time, cost, payment_id, disposable, interval_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?)",[n.replaceAll(r.v1(),"-",""),e.goods_name,e.goods_desc,new Date,e.cost||0,e.payment_id,e.disposable||0,e.interval_time||0],o)}}(),function(){exports.editInfo=function(e,o){d.query("UPDATE w_goods SET goods_name=?, goods_desc=?, cost=?, payment_id=?, disposable=?, interval_time=? WHERE id=?",[e.goods_name,e.goods_desc,e.cost||0,e.payment_id,e.disposable||0,e.interval_time||0,e.id],o)}}(),function(){exports.getById=function(e){return new Promise(function(o,i){d.query("SELECT a.* FROM w_goods a WHERE a.id=?",[e],function(e,n){if(e)return i(e);o(d.checkOnly(n)?n[0]:null)})})}}(),function(){exports.del=function(e,o){o(new Error("Permission Denied"))}}();