"use strict";function e(){p.backend.close(o.app.id,function(e,n){if(e)return s.error("backend %j close:",o.app.id,e);s.info("backend %j close: %j",o.app.id,n),process.exit(0)})}function n(e,n,u){if(!a.isString(u.body))return s.error("msg body is empty");e(n,u.body)}var u=require("path"),r=process.cwd(),o=require("./settings"),i=require("speedt-amq"),a=require("underscore"),l=require("emag.cfg"),p=require("emag.biz"),q=require("emag.handle"),t=require("log4js");t.configure({appenders:{app:{type:"dateFile",filename:u.join(r,"logs","app"),pattern:".yyyy-MM-dd.log",alwaysIncludePattern:!0,compress:!0},console:{type:"console"}},categories:{default:{appenders:["app","console"],level:"debug"}}});var s=t.getLogger("app");process.on("uncaughtException",function(e){s.error("uncaughtException:",e)}),process.on("SIGINT",e),process.on("SIGTERM",e),process.on("exit",e),p.backend.open(o.app.id,function(e,n){if(e)return s.error("backend %j open:",o.app.id,e);s.info("backend %j open: %j",o.app.id,n)}),i.start({"/queue/front.start":n.bind(null,q.front.start),"/queue/front.stop":n.bind(null,q.front.stop),"/queue/channel.open":n.bind(null,q.channel.open),"/queue/channel.close":n.bind(null,q.channel.close),"/queue/qq.1001":n.bind(null,q.channel.info),"/queue/qq.2001":n.bind(null,q.chat.one_for_one),"/queue/qq.2003":n.bind(null,q.chat.one_for_group),"/queue/qq.3001":n.bind(null,q.group.search),"/queue/qq.3003":n.bind(null,q.group.re_entry),"/queue/qq.3005":n.bind(null,q.group.quit),"/queue/qq.3007":n.bind(null,q.group.entry),"/queue/qq.5001":n.bind(null,q.pushCake.ready),"/queue/qq.5003":n.bind(null,q.pushCake.craps4),"/queue/qq.5005":n.bind(null,q.pushCake.bankerBet),"/queue/qq.5007":n.bind(null,q.pushCake.bankerDice),"/queue/qq.5009":n.bind(null,q.pushCake.unBankerBet),"/queue/qq.5011":n.bind(null,q.pushCake.bankerContinue),"/queue/qq.5013":n.bind(null,q.pushCake.bankerContinueBet)},function(e){s.error("amq error:",e)});