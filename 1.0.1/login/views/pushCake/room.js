"use strict";function t(t){t=t||36;for(var e=[],r=1,s=0;s<t;s+=4)e[s]=e[s+1]=e[s+2]=e[s+3]=r++;for(var n=t-1,a=0;a<t;a++){var i=Math.round(Math.random()*n);r=e[i],e[i]=e[n],e[n--]=r}return e}var e=1,r=0,s="ACT_STATUS_READY",n="ACT_STATUS_CRAPS4_BEFORE",a="ACT_STATUS_CRAPS4",i="ACT_STATUS_CRAPS4_AFTER",u="ACT_STATUS_BANKER_BET_BEFORE",o="ACT_STATUS_BANKER_BET",c="ACT_STATUS_BANKER_BET_AFTER",f=function(t){var r=this;r.opts=t,r.id=t.id,r.name=t.name||"Room "+t.id,r._users={},r._players={},r.create_user_id=t.user_id,r.create_time=(new Date).getTime(),r.act_seat=1,r.act_status=s,r._act_direction=e,r._free_seat=[1,2,3,4],r._player_count=r._free_seat.length,r.visitor_count=t.visitor_count||0,r.fund=t.fund||1e3,r.round_count=t.round_count||4,r.round_pno=1,r.round_no=1,r.round_no_first_seat=1,r.round_no_compare=[],r.round_no_compare_seat=1,r.banker_seat=0,r.banker_bets=[200,300,500]},l=f.prototype;l.getNextSeatBySeat=function(t){return t-=0,this._player_count<++t?1:t},l.getUser=function(t){return this._users[t]},l.getUsers=function(){return this._users},l.isPlayer=function(t){return 0<t.opts.seat},l.isReady=function(t){return 0<t.opts.is_ready},l.isQuit=function(t){return 0<t.opts.is_quit},l.isStart=function(){return this._player_count<=this.getReadyCount()},l.getReadyCount=function(){var t=0,e=!0,r=!1,s=void 0;try{for(var n,a=_.values(this._players)[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var i=n.value;this.isReady(i)&&++t}}catch(t){r=!0,s=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw s}}return t},l.release=function(){return 1>_.size(this._users)},l.isFull=function(){return this._player_count+this.visitor_count<=_.size(this._users)},function(){function t(t){var e=this._free_seat.shift();0<e&&(this._players[e]=t,t.opts.seat=e)}l.entry=function(e){var r=this;return r.getUser(e.id)?"已经在房间内":r.isFull()?"房间满员":(e.opts={},t.call(r,e),r._users[e.id]=e,e.opts.entry_time=(new Date).getTime(),e.opts.score=0,e.opts.is_quit=0,e.opts.is_ready=0,e)}}(),l.re_entry=function(t){var e=this,r=e.getUser(t.id);return r&&e.isPlayer(r)&&e.isQuit(r)?(r.opts.re_entry_time=(new Date).getTime(),r.opts.is_quit=0,r.server_id=t.server_id,r.channel_id=t.channel_id,r):""},l.quit=function(t){var e=this,r=e.getUser(t);if(!r)return!0;if(e.isPlayer(r)){if(e.isStart())return r.opts.quit_time=(new Date).getTime(),r.opts.is_quit=1,!1;e._free_seat.push(r.opts.seat),delete e._players[r.opts.seat]}return delete e._users[r.id]},l.ready=function(e){var r=this;if(r.act_status!==s)return"ACT_STATUS_READY";if(r.isStart())return"已经开始";var n=r.getUser(e);return n?r.isPlayer(n)?r.isReady(n)?"已经举手":(n.opts.is_ready=1,r.isStart()&&(r.act_status=a,r.act_seat=r.banker_seat||1,r._cards_36=t()),n):"不能举手":"用户不存在"},function(){function t(){var t=0,e=!0,r=!1,s=void 0;try{for(var n,a=_.values(this._players)[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){n.value.opts.craps&&t++}}catch(t){r=!0,s=t}finally{try{!e&&a.return&&a.return()}finally{if(r)throw s}}return t}function e(){var t=0,e=0,r=!0,s=!1,n=void 0;try{for(var a,i=_.values(this._players)[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var u=a.value,o=u.opts.craps[0]-0+u.opts.craps[1];if(11<o)return u.opts.seat;t<=o&&(t=o,e=u.opts.seat)}}catch(t){s=!0,n=t}finally{try{!r&&i.return&&i.return()}finally{if(s)throw n}}return e}l.craps4=function(r){var s=this;if(s.act_status!==a)return"ACT_STATUS_CRAPS4";var n=s.getUser(r);return n?s.act_seat!==n.opts.seat?"还没轮到你":n.opts.craps?"craps":(n.opts.craps=[_.random(1,6),_.random(1,6)],s._player_count<=t.call(s)?(s.act_status=i,s.banker_bets=[200,300,500],s.banker_seat=e.call(s),s.act_seat=s.banker_seat):s.act_seat=s.getNextSeatBySeat(s.act_seat),n):"用户不存在"},l.craps4_after=function(){var t=this;return t.act_status!==i?"ACT_STATUS_CRAPS4_AFTER":(t.act_status=u,t)}}(),l.bankerBet=function(t,e){},function(){l.bankerCraps=function(t){}}(),function(){l.unBankerBet=function(t,e){}}(),function(){l.compareCard=function(){}}(),l.bankerGoOn=function(){};