"use strict";var n=require("emag.biz"),e=require("../settings"),r=require("speedt-utils").utils,t=require("request"),i=require("log4js").getLogger("controllers.user");!function(){function e(n,e){n.send({})}function r(n,e,r){if("string"==typeof r)return n.send({error:{msg:r}});e(r)}exports.register=function(t,i,o){var u=t.body;n.user.register(u).then(e.bind(null,i)).catch(r.bind(null,i,o))}}(),exports.loginUI=function(n,r,t){r.render("user/login",{conf:e,data:{}})},function(){function e(n,e){n.send({data:e})}function r(n,e,r){if("string"==typeof r)return n.send({error:{code:r}});e(r)}exports.login=function(t,i,o){var u=t.body;n.user.login(u).then(e.bind(null,i)).catch(r.bind(null,i,o))}}(),function(){function e(n,e){n.send(e)}function r(n,e,r){if("string"==typeof r)return n.send({error:{code:r}});e(r)}exports.wx=function(t,i,o){var u=t.body;n.user.wx(u).then(e.bind(null,i)).catch(r.bind(null,i,o))}}(),function(){function e(n){n.send("OK")}function r(n,e,r){if("string"==typeof r)return n.send({error:{code:r}});e(r)}exports.payment=function(t,i,o){var u=t.body;n.user.payment(u).then(e.bind(null,i)).catch(r.bind(null,i,o))}}(),exports.avatarUI=function(e,r,i){var o=e.query.id;n.user.getById(o).then(function(n){if(!n||!n.weixin_avatar)return i(new Error("Not Found"));e.pipe(t(n.weixin_avatar).on("error",i)).pipe(r)}).catch(i)};