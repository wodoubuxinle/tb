"use strict";var e=require("path"),r=process.cwd(),i=require(e.join(r,"settings")),u=require("node-uuid"),s=require("speedt-utils").md5,t=require("speedt-utils").utils,n=require("emag.db").mysql,c=require("emag.db").redis,a=require("emag.cfg"),d=require("emag.biz"),o=require("underscore");o.str=require("underscore.string"),o.mixin(o.str.exports()),function(){exports=module.exports=function(e,r){return new Promise(function(i,u){(r||n).query("SELECT c.nickname target_nickname, b.nickname source_nickname, a.* FROM (SELECT * FROM s_user_transfer WHERE source_id=?) a LEFT JOIN s_user b ON (a.source_id=b.id) LEFT JOIN s_user c ON (a.target_id=c.id) WHERE b.id IS NOT NULL AND c.id IS NOT NULL ORDER BY a.create_time DESC",[e],function(e,r){if(e)return u(e);i(r)})})}}();