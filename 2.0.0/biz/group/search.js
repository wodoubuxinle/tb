"use strict";var e=require("path"),r=process.cwd(),i=require(e.join(r,"settings")),t=require("node-uuid"),u=require("speedt-utils").md5,n=require("speedt-utils").utils,o=require("emag.db").mysql,s=require("emag.db").redis,c=require("emag.cfg"),d=require("emag.biz"),g=require("underscore");g.str=require("underscore.string"),g.mixin(g.str.exports());var m=require("emag.model").roomPool,a=require("log4js").getLogger("biz.group");!function(){function e(e){return e.group_id?Promise.reject("MUST_BE_QUIT"):new Promise(function(r,i){d.group.genId().then(function(i){e.group_id=i,r(e)}).catch(i)})}function r(e,r){var i=m.create(e,r);return Promise.resolve([i.id,i.name,i.fund,i.round_count,i.visitor_count])}exports=module.exports=function(i,t,u){return g.isObject(u)?g.isArray(u)?Promise.reject("INVALID_PARAMS"):new Promise(function(n,o){d.user.getByChannelId(i,t).then(e).then(d.user.entryGroup).then(r.bind(null,u)).then(function(e){return n(e)}).catch(o)}):Promise.reject("INVALID_PARAMS")}}();