"use strict";var e=require("path"),n=process.cwd(),r=require(e.join(n,"settings")),t=require("node-uuid"),u=require("speedt-utils").md5,o=require("speedt-utils").utils,i=require("emag.db").mysql,s=require("emag.db").redis,c=require("emag.cfg"),_=require("emag.biz"),a=require("underscore");a.str=require("underscore.string"),a.mixin(a.str.exports()),function(){function e(e){return e?Promise.reject("用户名已存在"):Promise.resolve()}function n(e,n){return e.id=n,e.user_pass=u.hex(e.user_pass||"123456"),e.status=1,e.create_time=new Date,e.current_score=0,e.vip=0,e.consume_count=0,e.win_count=0,e.lose_count=0,e.win_score_count=0,e.lose_score_count=0,e.line_gone_count=0,e.gold_count=e.gold_count||100,e.sex=e.sex||0,new Promise(function(n,t){i.query(r,[e.id,e.user_name,e.user_pass,e.status,e.create_time,e.mobile,e.openid,e.weixin_avatar,e.current_score,e.nickname,e.vip,e.consume_count,e.win_count,e.lose_count,e.win_score_count,e.lose_score_count,e.line_gone_count,e.gold_count,e.weixin_original,e.sex],function(r){if(r)return t(r);n(e)})})}exports=module.exports=function(r,t){return new Promise(function(t,u){_.user.getByName(r.user_name).then(e).then(_.user.genId).then(n.bind(null,r)).then(function(){return t(r)}).catch(u)})};var r="INSERT INTO s_user (id, user_name, user_pass, status, create_time, mobile, openid, weixin_avatar, current_score, nickname, vip, consume_count, win_count, lose_count, win_score_count, lose_score_count, line_gone_count, gold_count, weixin_original, sex) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)"}();