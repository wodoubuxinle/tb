"use strict";var e=require("path"),r=process.cwd(),i=require(e.join(r,"settings")),t=require("node-uuid"),u=require("speedt-utils").md5,s=require("speedt-utils").utils,n=require("emag.db").mysql,d=require("emag.db").redis,o=require("emag.cfg"),c=require("emag.biz"),a=require("underscore");a.str=require("underscore.string"),a.mixin(a.str.exports()),function(){exports=module.exports=function(e,r){n.query("UPDATE s_cfg SET value_=? WHERE key_=? AND type_=?",[e.value_,e.key_,e.type_],function(t,u){return t?r(t):1>u.affectedRows?r(new Error("affectedRows: 0")):void d.select(i.redis.database,function(i){if(i)return r(i);d.hset("cfg::"+e.type_,e.key_,e.value_,d.print),r(null,e)})})}}();