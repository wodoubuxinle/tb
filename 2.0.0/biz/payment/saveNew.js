"use strict";var e=require("path"),r=process.cwd(),i=require(e.join(r,"settings")),t=require("node-uuid"),u=require("speedt-utils").md5,d=require("speedt-utils").utils,s=require("emag.db").mysql,n=require("emag.db").redis,o=require("emag.cfg"),a=require("emag.biz"),c=require("underscore");c.str=require("underscore.string"),c.mixin(c.str.exports()),function(){exports=module.exports=function(e,r){return e.original_data=JSON.stringify(e),e.id=e.id||d.replaceAll(t.v1(),"-",""),e.create_time=new Date,new Promise(function(i,t){(r||s).query("INSERT INTO s_user_payment (id, user_id, goods_id, create_time, order_id, original_data) VALUES (?, ?, ?, ?, ?, ?)",[e.id,e.user_id,e.goods_id,e.create_time,e.order_id,e.original_data],function(r,u){if(r)return t(r);i(e)})})}}();