"use strict";var e=require("path"),r=process.cwd(),s=require(e.join(r,"settings")),i=require("node-uuid"),u=require("speedt-utils").md5,n=require("speedt-utils").utils,t=require("emag.db").mysql,o=require("emag.db").redis,a=require("emag.cfg"),c=require("emag.biz"),d=require("underscore");d.str=require("underscore.string"),d.mixin(d.str.exports()),function(){function e(e,r){return u.hex(e.old_pass)!==r.user_pass?Promise.reject("原始密码错误"):Promise.resolve()}function r(e){return e.user_pass=u.hex(e.user_pass),new Promise(function(r,i){t.query(s,[e.user_pass,e.id],function(e){if(e)return i(e);r()})})}exports=module.exports=function(s){return d.isString(s.user_pass)?(s.user_pass=d.trim(s.user_pass),""===s.user_pass?Promise.reject("INVALID_PARAMS"):new Promise(function(i,u){c.manager.getById(s.id).then(e.bind(null,s)).then(r.bind(null,s)).then(function(){return i(s)}).catch(u)})):Promise.reject("INVALID_PARAMS")};var s="UPDATE s_manager set user_pass=? WHERE id=?"}();