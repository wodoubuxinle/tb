"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e=require("path"),n=process.cwd(),t=require(e.join(n,"settings")),i=require("underscore"),u=require("emag.biz"),o=require("emag.cfg"),c=require("log4js").getLogger("handle.group");!function(){function e(r,e,n){var t=[e.channelId,JSON.stringify([3002,n,i.now(),e.seqId])];r("/queue/back.send.v3."+e.serverId,{priority:9},t,function(r){if(r)return c.error("group search:",r)})}function n(e,n,t){if("object"===(void 0===t?"undefined":r(t)))return c.error("group search:",t);if("invalid_user_id"===t)return c.debug("group search:",t);var u=[n.channelId,JSON.stringify([3002,,i.now(),n.seqId,t])];e("/queue/back.send.v3."+n.serverId,{priority:9},u,function(r){if(r)return c.error("group search:",r)})}exports.search=function(r,t){try{var i=JSON.parse(t)}catch(r){return}try{var o=JSON.parse(i.data)}catch(r){return}u.group.search(i.serverId,i.channelId,o).then(e.bind(null,r,i)).catch(n.bind(null,r,i))}}(),function(){function e(r,e,n){if(n){var t=[null,JSON.stringify([3004,n[1],i.now(),e.seqId])],u=!0,o=!1,a=void 0;try{for(var d,f=i.values(n[0])[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var s=d.value;s.server_id&&s.channel_id&&(t.splice(0,1,s.channel_id),r("/queue/back.send.v3."+s.server_id,{priority:9},t,function(r){if(r)return c.error("group re_entry:",r)}))}}catch(r){o=!0,a=r}finally{try{!u&&f.return&&f.return()}finally{if(o)throw a}}}}function n(e,n,t){if("object"===(void 0===t?"undefined":r(t)))return c.error("group re_entry:",t);if("invalid_user_id"===t)return c.debug("group re_entry:",t);var u=[n.channelId,JSON.stringify([3004,,i.now(),n.seqId,t])];e("/queue/back.send.v3."+n.serverId,{priority:9},u,function(r){if(r)return c.error("group re_entry:",r)})}exports.re_entry=function(r,t){try{var i=JSON.parse(t)}catch(r){return}u.group.re_entry(i.serverId,i.channelId).then(e.bind(null,r,i)).catch(n.bind(null,r,i))}}(),function(){function e(r,e,n){if(n){var t=[null,JSON.stringify([3006,n[1],i.now(),e.seqId])],u=!0,o=!1,a=void 0;try{for(var d,f=i.values(n[0])[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var s=d.value;s.server_id&&s.channel_id&&(t.splice(0,1,s.channel_id),r("/queue/back.send.v3."+s.server_id,{priority:9},t,function(r){if(r)return c.error("group quit:",r)}))}}catch(r){o=!0,a=r}finally{try{!u&&f.return&&f.return()}finally{if(o)throw a}}}}function n(e,n,t){if("object"===(void 0===t?"undefined":r(t)))return c.error("group quit:",t);if("invalid_user_id"===t)return c.debug("group quit:",t);var u=[n.channelId,JSON.stringify([3006,,i.now(),n.seqId,t])];e("/queue/back.send.v3."+n.serverId,{priority:9},u,function(r){if(r)return c.error("group quit:",r)})}exports.quit=function(r,t){try{var i=JSON.parse(t)}catch(r){return}u.group.quit(i.serverId,i.channelId).then(e.bind(null,r,i)).catch(n.bind(null,r,i))}}(),function(){function e(r,e,n){if(n){var t=[null,JSON.stringify([3008,n[1],i.now(),e.seqId])],u=!0,o=!1,a=void 0;try{for(var d,f=i.values(n[0])[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var s=d.value;s.server_id&&s.channel_id&&(t.splice(0,1,s.channel_id),r("/queue/back.send.v3."+s.server_id,{priority:9},t,function(r){if(r)return c.error("group entry:",r)}))}}catch(r){o=!0,a=r}finally{try{!u&&f.return&&f.return()}finally{if(o)throw a}}}}function n(e,n,t){if("object"===(void 0===t?"undefined":r(t)))return c.error("group entry:",t);if("invalid_user_id"===t)return c.debug("group entry:",t);var u=[n.channelId,JSON.stringify([3008,,i.now(),n.seqId,t])];e("/queue/back.send.v3."+n.serverId,{priority:9},u,function(r){if(r)return c.error("group entry:",r)})}exports.entry=function(r,t){try{var i=JSON.parse(t)}catch(r){return}u.group.entry(i.serverId,i.channelId,i.data).then(e.bind(null,r,i)).catch(n.bind(null,r,i))}}();